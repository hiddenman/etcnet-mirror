#!/bin/bash

# This script tries to create a PPP interface.

usage()
{
	echo "Usage: $0 <interface>" > /dev/stderr
	exit 1
}

[ -z "$1" ] && usage
NAME=$1

. $SCRIPTDIR/functions
pickup_options
echo $PPPD $DEFAULT_PPPD
${PPPD:=$DEFAULT_PPPD}
echo $PPPD $DEFAULT_PPPD

[ -x "$PPPD" ] || {
	print_error "$PPPD does not exist or is not executable. Try installing ppp RPM."
	exit 1
}

# This one is a must.
BASIC_PPPOPTIONS="updetach"

${PPPOPTIONSFILE:=$DEFAULT_PPPOPTIONSFILE}
if [ -n "$PPPOPTIONSFILE" ]; then
	PROF_PPPOPTIONSFILE=`profiled_filename $PPPOPTIONSFILE`
	[ -s $PROF_PPPOPTIONSFILE ] && BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS file $PROF_PPPOPTIONSFILE"
fi
${PPPINITCHAT:=$DEFAULT_PPPINITCHAT}
if [ -n "$PPPINITCHAT" ]; then
	PROF_PPPINITCHAT=`profiled_filename $PPPINITCHAT`
	[ -s $PROF_PPPINITCHAT ] && BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS init $PROF_PPPINITCHAT"
fi
${PPPCONNECTCHAT:=$DEFAULT_PPPCONNECTCHAT}
if [ -n "$PPPCONNECTCHAT" ]; then
	PROF_PPPCONNECTCHAT=`profiled_filename $PPPCONNECTCHAT`
	[ -s $PROF_PPPCONNECTCHAT ] && BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS connect $PROF_PPPCONNECTCHAT"
fi
${PPPDISCONNECTCHAT:=$DEFAULT_PPPDISCONNECTCHAT}
if [ -n "$PPPDISCONNECTCHAT" ]; then
	PROF_PPPDISCONNECTCHAT=`profiled_filename $PPPDISCONNECTCHAT`
	[ -s $PROF_PPPDISCONNECTCHAT ] && BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS disconnect $PROF_PPPDISCONNECTCHAT"
fi
BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS${MAXFAIL:+ maxfail $MAXFAIL}"
is_yes "$PERSIST" && BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS persist"
BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS${HOLDOFF:+ holdoff $HOLDOFF}"
BASIC_PPPOPTIONS="$BASIC_PPPOPTIONS${IDLE:+ idle $idle}"

# Let the show start...
$PPPD $BASIC_PPPOPTIONS $EXTRA_PPPOPTIONS
